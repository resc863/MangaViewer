<Page
    x:Class="MangaViewer.Pages.SearchPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="using:MangaViewer.ViewModels"
    xmlns:controls="using:MangaViewer.Controls"
    x:Name="SearchPageRoot"
    mc:Ignorable="d" Background="Transparent">
    <Page.Resources>
        <Style x:Key="GalleryTileButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="0"/>
        </Style>
        <ItemsPanelTemplate x:Key="TagWrapPanelTemplate">
            <controls:TagWrapPanel HorizontalSpacing="4" VerticalSpacing="6" />
        </ItemsPanelTemplate>
    </Page.Resources>
    <Grid Padding="12" RowSpacing="12" Background="Transparent" PointerWheelChanged="OnPointerWheelChanged">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <StackPanel Orientation="Horizontal" Spacing="8">
            <AutoSuggestBox x:Name="QueryBox" Width="360" PlaceholderText="검색어 입력" QuerySubmitted="OnQuerySubmitted"/>
            <Button Content="검색" Click="OnSearchClick"/>
            <ProgressRing x:Name="BusyRing" Width="24" Height="24" IsActive="False"/>
        </StackPanel>
        <ScrollViewer x:Name="ResultsScroll" Grid.Row="1" Background="Transparent">
            <ItemsControl x:Name="ResultsList" IsTabStop="False">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <ItemsWrapGrid Orientation="Horizontal" MaximumRowsOrColumns="0" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="vm:GalleryItemViewModel">
                        <Grid Width="{Binding ElementName=SearchPageRoot, Path=TileWidth}" Margin="4" Background="{ThemeResource SolidBackgroundFillColorBaseBrush}" Loaded="TileRoot_Loaded" Unloaded="TileRoot_Unloaded">
                            <Grid.ContextFlyout>
                                <MenuFlyout Opening="MetaFlyout_Opening">
                                    <MenuFlyoutItem Text="불러오기" Command="{x:Bind OpenCommand}"/>
                                    <MenuFlyoutItem Text="상세 정보" Click="OnDetailsMenuClick"/>
                                    <MenuFlyoutSeparator/>
                                    <MenuFlyoutSubItem Text="작가" x:Name="ArtistItem" />
                                    <MenuFlyoutSubItem Text="그룹" x:Name="GroupItem" />
                                    <MenuFlyoutSubItem Text="태그" x:Name="TagsRoot" />
                                </MenuFlyout>
                            </Grid.ContextFlyout>
                            <Button Command="{x:Bind OpenCommand}" Style="{StaticResource GalleryTileButtonStyle}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                                <StackPanel Spacing="4">
                                    <Image Source="{x:Bind Thumbnail, Mode=OneWay}" Width="{Binding ElementName=SearchPageRoot, Path=TileWidth}" Height="{Binding ElementName=SearchPageRoot, Path=TileHeight}" Stretch="UniformToFill" />
                                    <TextBlock Text="{x:Bind Title}" TextWrapping="WrapWholeWords" MaxLines="2" FontSize="13"/>
                                    <TextBlock Text="{x:Bind Artist}" Foreground="Gray" FontSize="12" TextTrimming="CharacterEllipsis"/>
                                </StackPanel>
                            </Button>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</Page>