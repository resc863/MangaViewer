<Window
    x:Class="MangaViewer.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewmodels="using:MangaViewer.ViewModels"
    xmlns:converters="using:MangaViewer.Converters"
    mc:Ignorable="d">

    <Grid x:Name="RootGrid" Background="Transparent">
        <Grid.Resources>
            <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
            <!-- NavigationView content background transparent so Mica shows in content -->
            <Style TargetType="NavigationView">
                <Setter Property="Background" Value="Transparent"/>
            </Style>
            <!-- Make NavigationView pane backgrounds transparent to let Mica show through -->
            <SolidColorBrush x:Key="NavigationViewDefaultPaneBackground" Color="Transparent"/>
            <SolidColorBrush x:Key="NavigationViewExpandedPaneBackground" Color="Transparent"/>
            <SolidColorBrush x:Key="NavigationViewTopPaneBackground" Color="Transparent"/>
        </Grid.Resources>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Top title / command bar using WinUI 3 CommandBar + AppBarButtons -->
        <Grid x:Name="AppTitleBar" Grid.Row="0" Height="40" Background="Transparent">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <CommandBar Grid.Column="0"
                        DefaultLabelPosition="Right"
                        Background="Transparent"
                        IsDynamicOverflowEnabled="True"
                        Margin="12,0,0,0"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Left">
                <CommandBar.PrimaryCommands>
                    <AppBarToggleButton ToolTipService.ToolTip="썸네일 패널"
                                         IsChecked="{Binding IsPaneOpen, Mode=TwoWay}">
                        <AppBarToggleButton.Icon>
                            <FontIcon Glyph="&#xE70e;" FontFamily="Segoe MDL2 Assets"/>
                        </AppBarToggleButton.Icon>
                    </AppBarToggleButton>
                    <AppBarToggleButton ToolTipService.ToolTip="북마크 패널"
                                         IsChecked="{Binding IsBookmarkPaneOpen, Mode=TwoWay}">
                        <AppBarToggleButton.Icon>
                            <FontIcon Glyph="&#xE735;" FontFamily="Segoe MDL2 Assets"/>
                        </AppBarToggleButton.Icon>
                    </AppBarToggleButton>
                    <AppBarButton Label="북마크 추가" Command="{Binding AddBookmarkCommand}">
                        <AppBarButton.Icon>
                            <FontIcon Glyph="&#xE141;" FontFamily="Segoe MDL2 Assets"/>
                        </AppBarButton.Icon>
                    </AppBarButton>
                    <AppBarSeparator/>
                    <AppBarButton Label="폴더 열기"
                                  Click="OpenFolder_Click"
                                  IsEnabled="{Binding IsOpenFolderEnabled}"
                                  Visibility="{Binding IsOpenFolderEnabled, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <AppBarButton.Icon>
                            <SymbolIcon Symbol="Folder"/>
                        </AppBarButton.Icon>
                    </AppBarButton>
                    <AppBarSeparator/>
                    <AppBarButton Label="{Binding DirectionButtonText}"
                                  Command="{Binding ToggleDirectionCommand}">
                        <AppBarButton.Icon>
                            <FontIcon Glyph="&#xE8AB;" FontFamily="Segoe MDL2 Assets"/>
                        </AppBarButton.Icon>
                    </AppBarButton>
                    <AppBarButton Label="{Binding CoverButtonText}"
                                  Command="{Binding ToggleCoverCommand}">
                        <AppBarButton.Icon>
                            <FontIcon Glyph="&#xE170;" FontFamily="Segoe MDL2 Assets"/>
                        </AppBarButton.Icon>
                    </AppBarButton>
                    <AppBarSeparator/>
                    <AppBarToggleButton Label="OCR" IsEnabled="{Binding IsOcrToggleEnabled}" IsChecked="{Binding IsOcrActive, Mode=TwoWay}">
                        <AppBarToggleButton.Icon>
                            <FontIcon Glyph="&#xE8C3;" FontFamily="Segoe MDL2 Assets"/>
                        </AppBarToggleButton.Icon>
                    </AppBarToggleButton>
                    <AppBarToggleButton Label="번역" IsEnabled="{Binding IsTranslationToggleEnabled}" IsChecked="{Binding IsTranslationActive, Mode=TwoWay}">
                        <AppBarToggleButton.Icon>
                            <FontIcon Glyph="&#xE8C1;" FontFamily="Segoe MDL2 Assets"/>
                        </AppBarToggleButton.Icon>
                    </AppBarToggleButton>
                </CommandBar.PrimaryCommands>
            </CommandBar>
            <!-- Drag region for system title bar behaviors -->
            <Grid x:Name="DragRegion" Grid.Column="1" Background="Transparent"/>
        </Grid>

        <!-- Navigation / content area -->
        <NavigationView Grid.Row="1" x:Name="LeftNav" IsBackButtonVisible="Auto"
                        IsPaneOpen="{Binding IsNavOpen, Mode=TwoWay}" PaneDisplayMode="Left" OpenPaneLength="240" CompactPaneLength="48"
                        IsTitleBarAutoPaddingEnabled="False" ItemInvoked="LeftNav_ItemInvoked" IsSettingsVisible="True" BackRequested="LeftNav_BackRequested"
                        Background="Transparent">
            <NavigationView.MenuItems>
                <NavigationViewItem Content="라이브러리" Icon="Library" Tag="Library"/>
                <NavigationViewItem Content="리더" Icon="Document" Tag="Reader"/>
                <NavigationViewItem Content="검색" Icon="Find" Tag="Search"/>
            </NavigationView.MenuItems>
            <NavigationView.PaneFooter>
                <StackPanel Margin="12,12,12,24" Background="Transparent">
                    <TextBlock Text="Manga Viewer" Opacity="0.6" FontSize="12"/>
                </StackPanel>
            </NavigationView.PaneFooter>
            <Frame x:Name="ContentFrame" Background="Transparent" />
        </NavigationView>
    </Grid>
</Window>
